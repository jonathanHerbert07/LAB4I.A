# LAB4I.A
En este laboratorio lo que haremos sera crear un clasificador de imagenes de objetos. Para lo que en grupo deberan seleccionar un objeto en particular por grupo. El objeto no deben repetirlo, para facilitar el trabajo. Lo vamos a crear se llama un "clasificador en cascada para características de Haar" para OpenCV. Un clasificador en cascada básicamente le dice a OpenCV qué buscar en las imágenes. Las camaras fotograficas incluso y los apps actuales para tomar fotos en dispositivos moviles utilizan este tipo de clasificador para detectar las características de la cara.  En la actualidad hay una gran cantidad de clasificadores en cascada por todo Internet y puedes encontrar fácilmente uno diferente y usarlo. Pero la mayoría de ellos son para reconocer rostros, ojos, oídos y bocas, pero el objetivo de hoy es decirle a OpenCV que reconozca un objeto de nuestra elección.  Podemos generar nuestro propio clasificador en cascada para las funciones de Haar usando lo que hemos revisado actualmente en machine learning por lo que vamos a e generar un "entrenamiento de un clasificador". Y al igual que entrenar un clasificador de datos, es relativamente facil. Relativamente facil, porque el procedimiento es sencillo, pero este requerira algo de poder de procesamiento, de sus ordenadores. Espero que sus maquinas no se quemen.  Seguir los siguientes paso: 1- Clonar el repositorio: git clone https://github.com/mrnugget/opencv-haar-classifier-training  El resto del laboratorio se ejcuta dentro de la carpeta de este proyecto 2- Necesitan opencv, si estan en linux   3- En este paso seleccionen el objeto y busquen por internet muchas imagenes de ese objeto, en diferentes angulos. En esto se pueden apoyar con los grupos de sus compañeros, porque sus imagenes positivas seran sus imagenes negativas. Las imagenes positivas son las imagenes de su objeto seleccionado, guardenlas en una carpeta que llamen positive_images Las imagenes negativas son las de otros objetios que no son el suyo. Guardenlas en una carpeta negative_images He visto funcionar al clasificador con poca data 40 positivas and 600 negativas, pero entre mas imagenes mejor. Pero mantener la propocion, las negativas deben ser mas. Preferiblemente en buena calidad y en jpg  4- Toca armar el set positivo y negativos, ejecuten lo siguiente: find ./positive_images -iname "*.jpg" > positives.txt find ./negative_images -iname "*.jpg" > negatives.txt  5- Ejecutar para construir la data de entrenamiento esto modifica las imagene spara que tengan el mismo tamaño y las combina como cuando yo les digo que peguen la imagen del mundo con las acciones. Les agrega la etiqueta perl bin/createsamples.pl positives.txt negatives.txt samples 1500\ "opencv_createsamples -bgcolor 0 -bgthresh 0 -maxxangle 1.1\ -maxyangle 1.1 maxzangle 0.5 -maxidev 40 -w 80 -h 40"  6- Vamos a mezclar las imagenes para eso, necesitamos copiar un archivo en opencv y compilarl. Compielo a donde hayan instalado opencv cp src/mergevec.cpp ~/opencv-4.0/apps/haartraining cd ~/opencv-4.0/apps/haartraining g++ `pkg-config --libs --cflags opencv` -I. -o mergevec mergevec.cpp\ cvboost.cpp cvcommon.cpp cvsamples.cpp cvhaarclassifier.cpp\ cvhaartraining.cpp\ -lopencv_core -lopencv_calib3d -lopencv_imgproc -lopencv_highgui -lopencv_objdetect 7- Este comando una vez compilado no ayudara a limpiar las imagenes con esto find ./samples -name '*.vec' > samples.txt ./mergevec samples.txt samples.vec  8- Ahora si a entrenar: opencv_traincascade -data classifier -vec samples.vec -bg negatives.txt\ -numStages 20 -minHitRate 0.999 -maxFalseAlarmRate 0.5 -numPos 1000\ -numNeg 600 -w 80 -h 40 -mode ALL -precalcValBufSize 1024\ -precalcIdxBufSize 1024  9- Esto genera un archivo haar, que pueden usar hasta en nodejs, pero pueden usar el clasificador de rostro que viene en los ejemplos de opencv cd ~/opencv-4.0/samples/c chmod +x build_all.sh ./build_all.sh ./facedetect --scale=2 --cascade="$HOME/sonic_classifier.xml"
